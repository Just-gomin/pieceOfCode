<script src="../lib/fx.js"></script>

<!--
    1. callbackê³¼ Promise
-->
<script>
  // ---------------
  // # ì¼ê¸‰
  // ---------------

  // Callback ì´ìš©
  function add10(a, callback) {
    setTimeout(() => callback(a + 10), 100);
  }

  //   add10(5, (res) => {
  //     log(res);
  //   });

  // Promise ì´ìš©
  function add20(a) {
    return new Promise((resolve) => setTimeout(() => resolve(a + 20), 100));
  }

  //   add20(5).then(log);

  //   add10(5, (res) => {
  //     add10(res, (res) => {
  //       add10(res, (res) => {
  //         add10(res, (res) => {
  //           log(res);
  //         });
  //       });
  //     });
  //   });

  //   add20(5).then(add20).then(add20).then(add20).then(log);
</script>

<!--
    # Callback ê³¼ Promiseì˜ ê°€ì¥ í° ì°¨ì´ì ì€, PromiseëŠ” returnì´ ê°€ëŠ¥í•˜ë‹¤ëŠ” ê²ƒì´ë‹¤.
    - PromiseëŠ” í•¨ìˆ˜ì˜ ì‚¬ìš©ì— ìˆì–´ ë” ê°€ë…ì„±ì´ ì¢‹ë‹¤.
    - ğŸ’¡ PromiseëŠ” ë¹„ë™ê¸° ìƒí™©ì„ ì¼ê¸‰ ê°’ìœ¼ë¡œ ë‹¤ë£¬ë‹¤ëŠ” ì ì—ì„œ ì•„ì£¼ ì¤‘ìš”í•˜ë‹¤. ğŸ’¡
        - ê°’ì„ ê°€ì§€ê³  ì¶”í›„ì— ì¡°ì‘í•  ìˆ˜ ìˆë‹¤.
-->

<!--
    2. ê°’ìœ¼ë¡œì„œì˜ Promise í™œìš©
-->
<script>
  const delay100 = (a) =>
    new Promise((resolve) => setTimeout(() => resolve(a), 100));

  const go1 = (a, f) => (a instanceof Promise ? a.then(f) : f(a));
  const add5 = (a) => a + 5;

  //   go1(go1(10, add5), log);
  //   go1(go1(delay100(10), add5), log);
</script>

<!--
    3. í•©ì„± ê´€ì ì—ì„œì˜ Promiseì™€ ëª¨ë‚˜ë“œ
    - ëª¨ë‚˜ë“œ : í•¨ìˆ˜ í•©ì„±ì„ ì•ˆì „í•˜ê²Œ í•  ìˆ˜ ìˆë„ë¡í•˜ëŠ” ë„êµ¬
-->
<script type="module">
  const f = (a) => a + 1;
  const g = (a) => a * a;

  //   log(g(f(1)));
  //   log(g(f()));
  // => í•¨ìˆ˜ê°€ ì•ˆì „í•˜ê²Œ í•©ì„±ë˜ì§€ ëª»í–ˆë‹¤. ì…ë ¥ì´ ì—†ìœ¼ë‚˜ í•¨ìˆ˜ê°€ ëê¹Œì§€ ì‹¤í–‰ë˜ì–´ ì•ˆì „í•˜ì§€ ëª»í•œ ì—°ì‚° ì§„í–‰

  //   [1]
  //     .map(f)
  //     .map(g)
  //     .forEach((r) => log(r));
  //   []
  //     .map(f)
  //     .map(g)
  //     .forEach((r) => log(r));
  // => Arrayê°€ í•¨ìˆ˜ê°€ ì•ˆì „í•˜ê²Œ í•©ì„±ë  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ëª¨ë‚˜ë“œ. ê°’ì´ ì—†ìœ¼ë‹ˆ ì—°ì‚°ì„ ì§„í–‰í•˜ì§€ ì•Šì•˜ë‹¤.

  //   Promise.resolve(2).then(f).then(g).then(log);
  //   new Promise((resolve) => setTimeout(() => resolve(2), 100))
  //     .then(f)
  //     .then(g)
  //     .then(log);
  // => Promiseê°€ íŠ¹ì • ìƒí™©ì—ì„œ ì•ˆì „í•˜ê²Œ í•¨ìˆ˜ë¥¼ í•©ì„±í•  ìˆ˜ ìˆë„ë¡ ë•ëŠ” ëª¨ë‚˜ë“œ.
</script>

<!--
    4. Kleisli Composition
    - ì˜¤ë¥˜ê°€ ìˆì„ ìˆ˜ ìˆëŠ” ìƒí™©ì—ì„œ ì•ˆì „í•˜ê²Œ í•¨ìˆ˜ë¥¼ í•©ì„± í•  ìˆ˜ ìˆê²Œí•˜ëŠ” ê·œì¹™

    - f, g
    - f(g(x)) = f(g(x))
    - f(g(x)) = g(x) => g(x)ë¥¼ ì‹¤í–‰í•˜ë©° ì˜¤ë¥˜ê°€ ë°œìƒí•´ë„ ê·¸ ê²°ê³¼ê°€ ê°™ë‹¤
-->
<script>
  let users = [
    { id: 1, name: "aa" },
    { id: 2, name: "bb" },
    { id: 3, name: "cc" },
  ];

  const getUserByID = (id) => find((u) => u.id === id, users);

  const f1 = ({ name }) => name;
  const g1 = getUserByID;
  const fg1 = (id) => f1(g1(id));

  log(fg1(1)); // ì—¬ëŸ¬ê°€ì§€ ìƒí™©ì—ì˜í•´ ì•ˆì „í•˜ê²Œ í•©ì„±ë˜ì§€ ëª»í•  ìˆ˜ ìˆë‹¤.

  const getUserByID2 = (id) =>
    find((u) => u.id === id, users) || Promise.reject("ì—†ì–´ìš”!");
  const g2 = getUserByID2;

  const fg2 = (id) =>
    Promise.resolve(id)
      .then(g2)
      .then(f1)
      .catch((a) => a);

  fg2(1).then(log);
  fg2().then(log); // ì˜¤ë¥˜ê°€ ë°œìƒí•´ë„ ì•ˆì „í•˜ê²Œ í•©ì„±ëœë‹¤.
</script>
